{"ast":null,"code":"/* eslint-disable functional/no-expression-statement */\nimport { INVALID_RATIOS_MESSAGE } from '../checks';\nimport { assert } from '../helpers';\nimport { distribute, equal, getAmountAndScale, greaterThan, greaterThanOrEqual, maximum } from '../utils';\nimport { transformScale } from './transformScale';\nfunction unsafeAllocate(calculator) {\n  return function allocate() {\n    for (var _len = arguments.length, _ref = new Array(_len), _key = 0; _key < _len; _key++) {\n      _ref[_key] = arguments[_key];\n    }\n    var dineroObject = _ref[0],\n      ratios = _ref[1];\n    var _dineroObject$toJSON = dineroObject.toJSON(),\n      amount = _dineroObject$toJSON.amount,\n      currency = _dineroObject$toJSON.currency,\n      scale = _dineroObject$toJSON.scale;\n    var distributeFn = distribute(calculator);\n    var shares = distributeFn(amount, ratios.map(function (ratio) {\n      return ratio.amount;\n    }));\n    return shares.map(function (share) {\n      return dineroObject.create({\n        amount: share,\n        currency: currency,\n        scale: scale\n      });\n    });\n  };\n}\nexport function safeAllocate(calculator) {\n  var allocateFn = unsafeAllocate(calculator);\n  var greaterThanOrEqualFn = greaterThanOrEqual(calculator);\n  var greaterThanFn = greaterThan(calculator);\n  var convertScaleFn = transformScale(calculator);\n  var maximumFn = maximum(calculator);\n  var equalFn = equal(calculator);\n  var zero = calculator.zero();\n  var ten = new Array(10).fill(null).reduce(calculator.increment, zero);\n  return function allocate() {\n    for (var _len2 = arguments.length, _ref2 = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n      _ref2[_key2] = arguments[_key2];\n    }\n    var dineroObject = _ref2[0],\n      ratios = _ref2[1];\n    var hasRatios = ratios.length > 0;\n    var scaledRatios = ratios.map(function (ratio) {\n      return getAmountAndScale(ratio, zero);\n    });\n    var highestRatioScale = hasRatios ? maximumFn(scaledRatios.map(function (_ref3) {\n      var scale = _ref3.scale;\n      return scale;\n    })) : zero;\n    var normalizedRatios = scaledRatios.map(function (_ref4) {\n      var amount = _ref4.amount,\n        scale = _ref4.scale;\n      var factor = equalFn(scale, highestRatioScale) ? zero : calculator.subtract(highestRatioScale, scale);\n      return {\n        amount: calculator.multiply(amount, calculator.power(ten, factor)),\n        scale: scale\n      };\n    });\n    var hasOnlyPositiveRatios = normalizedRatios.every(function (_ref5) {\n      var amount = _ref5.amount;\n      return greaterThanOrEqualFn(amount, zero);\n    });\n    var hasOneNonZeroRatio = normalizedRatios.some(function (_ref6) {\n      var amount = _ref6.amount;\n      return greaterThanFn(amount, zero);\n    });\n    var condition = hasRatios && hasOnlyPositiveRatios && hasOneNonZeroRatio;\n    assert(condition, INVALID_RATIOS_MESSAGE);\n    var _dineroObject$toJSON2 = dineroObject.toJSON(),\n      scale = _dineroObject$toJSON2.scale;\n    var newScale = calculator.add(scale, highestRatioScale);\n    return allocateFn(convertScaleFn(dineroObject, newScale), normalizedRatios);\n  };\n}","map":{"version":3,"names":["INVALID_RATIOS_MESSAGE","assert","distribute","equal","getAmountAndScale","greaterThan","greaterThanOrEqual","maximum","transformScale","unsafeAllocate","calculator","allocate","_len","arguments","length","_ref","Array","_key","dineroObject","ratios","_dineroObject$toJSON","toJSON","amount","currency","scale","distributeFn","shares","map","ratio","share","create","safeAllocate","allocateFn","greaterThanOrEqualFn","greaterThanFn","convertScaleFn","maximumFn","equalFn","zero","ten","fill","reduce","increment","_len2","_ref2","_key2","hasRatios","scaledRatios","highestRatioScale","_ref3","normalizedRatios","_ref4","factor","subtract","multiply","power","hasOnlyPositiveRatios","every","_ref5","hasOneNonZeroRatio","some","_ref6","condition","_dineroObject$toJSON2","newScale","add"],"sources":["/Users/chris/Desktop/uber/node_modules/@dinero.js/core/dist/esm/api/allocate.js"],"sourcesContent":["/* eslint-disable functional/no-expression-statement */\nimport { INVALID_RATIOS_MESSAGE } from '../checks';\nimport { assert } from '../helpers';\nimport { distribute, equal, getAmountAndScale, greaterThan, greaterThanOrEqual, maximum } from '../utils';\nimport { transformScale } from './transformScale';\nfunction unsafeAllocate(calculator) {\n  return function allocate() {\n    for (var _len = arguments.length, _ref = new Array(_len), _key = 0; _key < _len; _key++) {\n      _ref[_key] = arguments[_key];\n    }\n    var dineroObject = _ref[0],\n      ratios = _ref[1];\n    var _dineroObject$toJSON = dineroObject.toJSON(),\n      amount = _dineroObject$toJSON.amount,\n      currency = _dineroObject$toJSON.currency,\n      scale = _dineroObject$toJSON.scale;\n    var distributeFn = distribute(calculator);\n    var shares = distributeFn(amount, ratios.map(function (ratio) {\n      return ratio.amount;\n    }));\n    return shares.map(function (share) {\n      return dineroObject.create({\n        amount: share,\n        currency: currency,\n        scale: scale\n      });\n    });\n  };\n}\nexport function safeAllocate(calculator) {\n  var allocateFn = unsafeAllocate(calculator);\n  var greaterThanOrEqualFn = greaterThanOrEqual(calculator);\n  var greaterThanFn = greaterThan(calculator);\n  var convertScaleFn = transformScale(calculator);\n  var maximumFn = maximum(calculator);\n  var equalFn = equal(calculator);\n  var zero = calculator.zero();\n  var ten = new Array(10).fill(null).reduce(calculator.increment, zero);\n  return function allocate() {\n    for (var _len2 = arguments.length, _ref2 = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n      _ref2[_key2] = arguments[_key2];\n    }\n    var dineroObject = _ref2[0],\n      ratios = _ref2[1];\n    var hasRatios = ratios.length > 0;\n    var scaledRatios = ratios.map(function (ratio) {\n      return getAmountAndScale(ratio, zero);\n    });\n    var highestRatioScale = hasRatios ? maximumFn(scaledRatios.map(function (_ref3) {\n      var scale = _ref3.scale;\n      return scale;\n    })) : zero;\n    var normalizedRatios = scaledRatios.map(function (_ref4) {\n      var amount = _ref4.amount,\n        scale = _ref4.scale;\n      var factor = equalFn(scale, highestRatioScale) ? zero : calculator.subtract(highestRatioScale, scale);\n      return {\n        amount: calculator.multiply(amount, calculator.power(ten, factor)),\n        scale: scale\n      };\n    });\n    var hasOnlyPositiveRatios = normalizedRatios.every(function (_ref5) {\n      var amount = _ref5.amount;\n      return greaterThanOrEqualFn(amount, zero);\n    });\n    var hasOneNonZeroRatio = normalizedRatios.some(function (_ref6) {\n      var amount = _ref6.amount;\n      return greaterThanFn(amount, zero);\n    });\n    var condition = hasRatios && hasOnlyPositiveRatios && hasOneNonZeroRatio;\n    assert(condition, INVALID_RATIOS_MESSAGE);\n    var _dineroObject$toJSON2 = dineroObject.toJSON(),\n      scale = _dineroObject$toJSON2.scale;\n    var newScale = calculator.add(scale, highestRatioScale);\n    return allocateFn(convertScaleFn(dineroObject, newScale), normalizedRatios);\n  };\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}